
# Ответы к домашнему заданию к занятию «Компоненты Kubernetes»

### Задание. Необходимо определить требуемые ресурсы
Известно, что проекту нужны база данных, система кеширования, а само приложение состоит из бекенда и фронтенда. Опишите, какие ресурсы нужны, если известно:

1. Необходимо упаковать приложение в чарт для деплоя в разные окружения. 
2. База данных должна быть отказоустойчивой. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии. 
3. Кеш должен быть отказоустойчивый. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии. 
4. Фронтенд обрабатывает внешние запросы быстро, отдавая статику. Потребляет не более 50 МБ ОЗУ на каждый экземпляр, 0.2 ядра. 5 копий. 
5. Бекенд потребляет 600 МБ ОЗУ и по 1 ядру на копию. 10 копий.

### Решение.

Сначала сделаем рассчёт всех необходимых ресурсов:

| Приложение | ЦПУ      | ОЗУ, ГБ | Реплик |
|------------|----------|---------|--------|
| База       | 1        | 4       | 3      |
| Кеш        | 1        | 4       | 3      |
| Фронтенд   | 0.2      | 0.05    | 5      |
| Бекенд     | 1     | 0.6     | 10     |
| Итого      | 17       | 30.25   ||

- Учитывая минимальное количество требуемых нод - **3**,
получается, что на каждую ноду приходится по **6** ЦПУ и **10.1** ГБ ОЗУ.
- Однако, в случае, когда одна из нод отказывает, тогда остаётся **2** ноды,
и на каждую приходится уже по **9** ЦПУ и **15.2** ГБ ОЗУ.
- Добавим накладные расходы (взяты [отсюда](https://learnk8s.io/kubernetes-node-size)):
  - к каждой ноде добавляется 6+1+0.5+0.5+0.25+0.25+0.25+0.25+0.25+0.25 = 9.5% ЦПУ,
    итого **10.45%**
  - к каждой ноде прибавим 1 + 0.8 + 0.8 + 0.1 ГБ ОЗУ, итого **17.9** ГБ

Здесь неплохо бы, конечно, учесть дополнительные нагрузки на ноду,
в виде демонов мониторинга, итд, а так же пиковое потребление в моменты, например,
обновления версий ПО. Грубо можно отнести на это треть от всех мощностей.

Для управляющих нод, исходя [отсюда](https://docs.kublr.com/installation/hardware-recommendation/)
требуется:

|Master node|2 ГБ|1.5 ядра|
|-|-|-|

А всего нам требуется минимум 3 управляющие ноды.

Итак, если мы размещаем *control plane* на *working* нодах, то: 

**Итого:** получаем, что нужно **3** ноды с ресурсами ~**14 ядер** ЦПУ и ~**26 ГБ** ОЗУ на каждую.  
Скорее всего у провайдера можно будет заказать **3** виртуалки по **16 ядер** и **32 ГБ** ОЗУ.


